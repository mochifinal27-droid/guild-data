# =================================================================
# ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Replit (‡∏£‡∏±‡∏ô 24/7) - Select Menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
# =================================================================

import discord
from discord import app_commands
from discord.ui import Button, Modal, TextInput, View
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import json
import os
from threading import Thread
from flask import Flask

# 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets 
# ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Replit Secrets
BOT_TOKEN = os.environ.get("BOT_TOKEN") 
GUILD_ID = 1422980759433777194 
SHEET_NAME = 'guild roster data' 
WORKSHEET_NAME = 'guild roster' 

# ‡πÇ‡∏´‡∏•‡∏î JSON Service Account ‡∏à‡∏≤‡∏Å Replit Secrets
try:
    service_account_json_string = os.environ.get("GOOGLE_SERVICE_ACCOUNT_JSON")
    if not service_account_json_string:
        raise ValueError("GOOGLE_SERVICE_ACCOUNT_JSON Secret ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤")
    service_account_info = json.loads(service_account_json_string)

except ValueError as e:
    print(f"‚ùå FATAL ERROR: ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Google Service Account ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: {e}")
    exit()
except Exception as e:
    print(f"‚ùå FATAL ERROR: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î JSON: {e}")
    exit()

scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
creds = ServiceAccountCredentials.from_json_keyfile_dict(service_account_info, scope)

# ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets
try:
    client_gspread = gspread.authorize(creds)
    sheet = client_gspread.open(SHEET_NAME).worksheet(WORKSHEET_NAME) 
    print(f"‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet '{SHEET_NAME}' ‡πÅ‡∏•‡∏∞ Worksheet '{WORKSHEET_NAME}' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
except Exception as e:
    print(f"‚ùå FATAL ERROR: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets: {e}")
    exit()

# =================================================================
# 2. Modal ‡πÅ‡∏•‡∏∞ Select Menu (‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö UI)
# =================================================================

# --- Modal: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡πÑ‡∏°‡πà‡∏°‡∏µ Role) ---
class RegisterDataModal(Modal, title='‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô - ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2: ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'):
    def __init__(self, selected_role: str):
        super().__init__(timeout=None)
        self.selected_role = selected_role 

    in_game_name = TextInput(
        label='‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏° (In-game Name)',
        placeholder='‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏ô‡πÄ‡∏Å‡∏°...',
        max_length=50,
        required=True,
        style=discord.TextStyle.short
    )
    discord_id_input = TextInput(
        label='Discord ID',
        placeholder='‡∏õ‡πâ‡∏≠‡∏ô Discord ID (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: your_name#1234)',
        max_length=50,
        required=False,
        style=discord.TextStyle.short
    )
    level = TextInput(
        label='‡∏£‡∏∞‡∏î‡∏±‡∏ö (Level)',
        placeholder='‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...',
        max_length=10,
        required=True,
        style=discord.TextStyle.short
    )
    note = TextInput(
        label='‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)',
        placeholder='‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô...',
        max_length=200,
        required=False,
        style=discord.TextStyle.long
    )

    async def on_submit(self, interaction: discord.Interaction):
        data_row = [
            interaction.user.display_name, 
            str(interaction.user.id),       
            self.discord_id_input.value,   
            self.in_game_name.value,       
            self.selected_role,            # ‡πÉ‡∏ä‡πâ Role ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Select Menu
            self.level.value,              
            self.note.value,               
        ]

        try:
            sheet.append_row(data_row)
            await interaction.response.send_message(
                f'‚úÖ **‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!**\n'
                f'‡∏≠‡∏≤‡∏ä‡∏µ‡∏û: **{self.selected_role}**\n'
                f'‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheet ‡πÅ‡∏•‡πâ‡∏ß',
                ephemeral=True
            )
        except Exception as e:
            await interaction.response.send_message(
                f'‚ùå **‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•!** ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• ({e})',
                ephemeral=True
            )

# --- Select Menu: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Role (‡∏°‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û) ---
class RoleSelect(discord.ui.Select):
    def __init__(self):
        options = [
            # ‚ÄºÔ∏è ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‚ÄºÔ∏è
            discord.SelectOption(label="‡∏™‡∏∏‡πà‡∏¢‡πÄ‡∏°‡∏¥‡∏á-nightwaker", description="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡∏™‡∏∏‡πà‡∏¢‡πÄ‡∏°‡∏¥‡∏á", value="‡∏™‡∏∏‡πà‡∏¢‡πÄ‡∏°‡∏¥‡∏á-nightwaker"),
            discord.SelectOption(label="‡πÄ‡∏™‡∏µ‡πâ‡∏¢‡∏¢‡∏µ‡πà-ironclad", description="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡πÄ‡∏™‡∏µ‡πâ‡∏¢‡∏¢‡∏µ‡πà", value="‡πÄ‡∏™‡∏µ‡πâ‡∏¢‡∏¢‡∏µ‡πà-ironclad"),
            discord.SelectOption(label="‡∏ã‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏≠-bloodstorm", description="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡∏ã‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏≠", value="‡∏ã‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏≠-bloodstorm"),
            discord.SelectOption(label="‡∏ä‡∏π‡πà‡∏ß‡πÄ‡∏ß‡∏¥‡πà‡∏ô-celestune", description="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡∏ä‡∏π‡πà‡∏ß‡πÄ‡∏ß‡∏¥‡πà‡∏ô", value="‡∏ä‡∏π‡πà‡∏ß‡πÄ‡∏ß‡∏¥‡πà‡∏ô-celestune"),
            discord.SelectOption(label="‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ã‡∏µ‡∏¢‡∏á-sylph", description="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ã‡∏µ‡∏¢‡∏á", value="‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ã‡∏µ‡∏¢‡∏á-sylph"),
            discord.SelectOption(label="‡∏à‡∏µ‡πã‡∏ß‡∏•‡∏µ‡∏á-numina", description="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡∏à‡∏µ‡πã‡∏ß‡∏•‡∏µ‡∏á", value="‡∏à‡∏µ‡πã‡∏ß‡∏•‡∏µ‡∏á-numina"),
        ]
        super().__init__(placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...", options=options, custom_id="role_select_menu")

    async def callback(self, interaction: discord.Interaction):
        selected_role = self.values[0]
        # ‡πÄ‡∏õ‡∏¥‡∏î Modal (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á Role ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏õ
        await interaction.response.send_modal(RegisterDataModal(selected_role))

# =================================================================
# 3. View ‡∏´‡∏•‡∏±‡∏Å (‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞ Select Menu)
# =================================================================

class RegisterView(View):
    def __init__(self):
        super().__init__(timeout=None) 
        # Select Menu ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Row 0 (‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô‡∏™‡∏∏‡∏î)
        self.add_item(RoleSelect())

    # ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Row 1 (‡πÅ‡∏ñ‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

    # ‡∏õ‡∏∏‡πà‡∏°: ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)
    @discord.ui.button(label="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô", style=discord.ButtonStyle.secondary, custom_id="view_roster", row=1)
    async def view_roster_callback(self, interaction: discord.Interaction, button: Button):
        await interaction.response.send_message(
            "‚è≥ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å Google Sheets...", 
            ephemeral=True
        )

    # ‡∏õ‡∏∏‡πà‡∏°: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    @discord.ui.button(label="‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", style=discord.ButtonStyle.success, custom_id="update_data", row=1)
    async def update_data_callback(self, interaction: discord.Interaction, button: Button):
        await interaction.response.send_message("‚ùå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", ephemeral=True)

    # ‡∏õ‡∏∏‡πà‡∏°: ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
    @discord.ui.button(label="‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô", style=discord.ButtonStyle.danger, custom_id="delete_player", row=1)
    async def delete_player_callback(self, interaction: discord.Interaction, button: Button):
        await interaction.response.send_message("‚ùå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", ephemeral=True)


# =================================================================
# 4. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏≠‡∏ó‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
# =================================================================

class MyClient(discord.Client):
    def __init__(self, *, intents: discord.Intents):
        super().__init__(intents=intents)
        self.tree = app_commands.CommandTree(self)
        self.register_modal_command = None

    async def on_ready(self):
        await self.wait_until_ready()
        
        # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á /‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Select Menu
        if not self.register_modal_command:
            @app_commands.command(name="‡∏™‡∏°‡∏±‡∏Ñ‡∏£", description="‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ)")
            async def register_modal_command_func(interaction: discord.Interaction):
                await interaction.response.send_message(
                    "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ **Select Menu** ‡πÉ‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£",
                    ephemeral=True
                )
            self.register_modal_command = register_modal_command_func
            self.tree.add_command(self.register_modal_command)
        
        try:
            await self.tree.sync()
            print("‚úÖ Slash Command ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Global)")
        except Exception as e:
             print(f"‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: {e}")
        
        self.add_view(RegisterView()) 
        
        print(f'ü§ñ Logged in as {self.user} (ID: {self.user.id})')
        print('üéâ ‡∏ö‡∏≠‡∏ó‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! (Bot is Ready!)')

    @app_commands.command(name="mytest", description="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Slash Command")
    async def test_command(self, interaction: discord.Interaction):
        await interaction.response.send_message("‚úÖ ‡∏ö‡∏≠‡∏ó‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß!", ephemeral=True)
        
    @app_commands.command(name="postbutton", description="‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô")
    @app_commands.default_permissions(manage_guild=True) 
    async def post_register_button_command(self, interaction: discord.Interaction):
        await interaction.response.send_message(
            "üëá **‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì** üëá", 
            view=RegisterView()
        )

# =================================================================
# 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô 24/7 ‡∏ö‡∏ô Replit
# =================================================================
app = Flask(__name__)

@app.route('/')
def home():
    return "Discord Bot is running and connected to Google Sheets!"

def run_server():
    app.run(host='0.0.0.0', port=8080) 

def start_bot():
    intents = discord.Intents.default()
    intents.message_content = True
    intents.members = True 
    intents.presences = True 
    client = MyClient(intents=intents)
    try:
        if not BOT_TOKEN:
             raise discord.LoginFailure("BOT_TOKEN is missing from Replit Secrets.")
             
        client.run(BOT_TOKEN)
    except discord.LoginFailure:
        print("‚ùå FATAL ERROR: Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö BOT_TOKEN ‡πÉ‡∏ô Replit Secrets")
    except Exception as e:
        print(f"‚ùå FATAL ERROR: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏£‡∏±‡∏ô‡∏ö‡∏≠‡∏ó: {e}")

if __name__ == '__main__':
    # ‡πÄ‡∏£‡∏¥‡πà‡∏° Web Server ‡∏Å‡πà‡∏≠‡∏ô
    t = Thread(target=run_server)
    t.start()
    
    # ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ô Discord Bot
    start_bot()
